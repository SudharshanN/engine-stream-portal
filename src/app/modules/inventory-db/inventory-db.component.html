<div fxLayout="column" fxLayoutGap="20px" >
    <div fxLayoutAlign="center center">
        <div fxFlex fxLayout fxLayoutAlign="start">
            <mat-form-field fxFlex="40%">
                <input matInput type="text" (keyup)="applyFilter($event)" placeholder="Filter" #input>
              </mat-form-field>
        </div>
        <div fxFlex fxLayout fxLayoutAlign="end">
            <mat-paginator  [pageSize]="2" [pageSizeOptions]="[2, 4, 6, 10, 20]" showFirstLastButtons>
            </mat-paginator>
        </div>
    </div>
    <div fxLayoutAlign="center center">
        <table mat-table #outerSort="matSort" 
            [dataSource]="dataSource" 
            multiTemplateDataRows 
            class="mat-elevation-z8" 
            matSort>
            <ng-container matColumnDef="{{column}}" *ngFor="let column of columnsToDisplay">
                <div *ngIf="column === 'select'">
                    <th mat-header-cell *matHeaderCellDef> 
                        <mat-checkbox>
                        </mat-checkbox>
                    </th>
                </div>
                <div *ngIf="column === 'sno' || column === 'actions' ">
                    <th class="parts-inv-header" mat-header-cell *matHeaderCellDef> 
                        {{columnsToDisplayHeaders[column]}} 
                    </th>
                </div>
                <div  *ngIf="column != 'select' && column != 'sno' && column != 'actions'">
                    <th class="parts-inv-header" mat-header-cell *matHeaderCellDef mat-sort-header>
                        {{columnsToDisplayHeaders[column]}} 
                    </th>
                </div>
                <td mat-cell *matCellDef="let element"> 
                    <div *ngIf="column === 'select'">
                        <mat-checkbox>
                        </mat-checkbox>
                    </div>
                    <div *ngIf="column === 'sno' && element.batches?.data.length"
                    (click)="toggleRow(element, $event)"> 
                        <span class="material-icons">add</span>
                    </div>
                    <div *ngIf="column === 'actions'">
                        <button mat-raised-button color="primary" (click)="getSalesHistory($event)">Sales History</button>
                    </div>
                    <div *ngIf="column != 'Actions'">
                        {{element[column]}}
                    </div>
                </td>
            </ng-container>

            <!-- Expanded Content Column - The detail row is made up of this one column that spans across all columns -->
            <ng-container matColumnDef="expandedDetail">
                <td mat-cell *matCellDef="let element" [attr.colspan]="columnsToDisplay.length" class="no-border-bottom-width">
                    <div class="batch-details" *ngIf="element.batches?.data.length" [@detailExpand]="element == expandedElement ? 'expanded' : 'collapsed'">
                        <div class="inner-table mat-elevation-z8" *ngIf="expandedElement">
                
                            <table #innerTables mat-table #innerSort="matSort" 
                                [dataSource]="element.batches" 
                                matSort>
                                <ng-container matColumnDef="{{innerColumn}}" *ngFor="let innerColumn of innerDisplayedColumns">
                                    <div *ngIf="innerColumn === 'select'">
                                        <th mat-header-cell *matHeaderCellDef> 
                                            <mat-checkbox>
                                            </mat-checkbox>
                                        </th>
                                    </div>
                                    <div *ngIf="innerColumn === 'actions'">
                                        <th mat-header-cell *matHeaderCellDef> 
                                            {{outerColumnsHeaders[innerColumn]}}
                                        </th>
                                    </div>
                                    <div *ngIf="innerColumn != 'actions' && innerColumn != 'select' ">
                                        <th mat-header-cell *matHeaderCellDef mat-sort-header> 
                                            {{outerColumnsHeaders[innerColumn]}}
                                        </th>
                                    </div>
                                
                                    <td mat-cell *matCellDef="let element">
                                        <div *ngIf="innerColumn === 'select'">
                                            <mat-checkbox>
                                            </mat-checkbox>
                                        </div>
                                        <div *ngIf="innerColumn === 'actions'">
                                            <button mat-raised-button color="primary" (click)="getPartFullDetails($event)">View</button>
                                        </div>
                                        <div *ngIf="innerColumn === 'materialSerialNumber'">
                                            <a (click)="getPartDetails(element)">{{element[innerColumn]}}</a>
                                        </div>
                                        <div *ngIf="innerColumn != 'materialSerialNumber'">
                                            {{element[innerColumn]}}
                                        </div>
                                    </td>
                                </ng-container>
                                <tr mat-header-row *matHeaderRowDef="innerDisplayedColumns"></tr>
                                <tr mat-row *matRowDef="let row; columns: innerDisplayedColumns;"></tr>
                            </table>
                        </div>
                    </div>
                </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="columnsToDisplay"></tr>
            <tr mat-row *matRowDef="let element; columns: columnsToDisplay; let i = index" 
                [class.batch-details-element-row]="element.batches?.data.length"
                [class.batch-expanded-row]="expandedElement === element" >
            </tr>
            <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="batch-details-row"></tr>
            <tr class="mat-row" *matNoDataRow>
                <td class="mat-cell" colspan="5">No data matching the filter "{{input.value}}"</td>
            </tr>
        </table>
    </div>
    
</div>